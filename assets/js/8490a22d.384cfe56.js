"use strict";(self.webpackChunksolus_help_center=self.webpackChunksolus_help_center||[]).push([[8575],{27781:(e,o,i)=>{i.r(o),i.d(o,{assets:()=>a,contentTitle:()=>n,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>d});var l=i(85893),s=i(11151);const t={title:"Local Repository",summary:"Packaging Using a Local Repository"},n="Packaging Using a Local Repository",r={id:"packaging/advanced-config/local-repository",title:"Local Repository",description:"This guide walks you through the steps necessary to tell solbuild how to utilise locally built .eopkg's that are not yet in the Solus repository.",source:"@site/docs/packaging/advanced-config/local-repository.md",sourceDirName:"packaging/advanced-config",slug:"/packaging/advanced-config/local-repository",permalink:"/docs/packaging/advanced-config/local-repository",draft:!1,unlisted:!1,editUrl:"https://github.com/getsolus/help-center-docs/tree/master/docs/packaging/advanced-config/local-repository.md",tags:[],version:"current",lastUpdatedAt:1705526616,formattedLastUpdatedAt:"Jan 17, 2024",frontMatter:{title:"Local Repository",summary:"Packaging Using a Local Repository"},sidebar:"packagingSidebar",previous:{title:"Eopkg Configuration",permalink:"/docs/packaging/advanced-config/eopkg-configuration"},next:{title:"Git Basics",permalink:"/docs/packaging/git-basics"}},a={},d=[{value:"Install the local profile",id:"install-the-local-profile",level:2},{value:"Utilising the local repository",id:"utilising-the-local-repository",level:2},{value:"Best practices when working with a solbuild local repository",id:"best-practices-when-working-with-a-solbuild-local-repository",level:2},{value:"Eopkg and local repositories",id:"eopkg-and-local-repositories",level:2},{value:"Generating an eopkg index for the local solbuild repository",id:"generating-an-eopkg-index-for-the-local-solbuild-repository",level:3},{value:"A note on package resolution priority",id:"a-note-on-package-resolution-priority",level:3},{value:"Adding the local solbuild repo to the eopkg repository database",id:"adding-the-local-solbuild-repo-to-the-eopkg-repository-database",level:3},{value:"Checking the currently known eopkg repositories",id:"checking-the-currently-known-eopkg-repositories",level:4},{value:"Adding repositories in the correct order",id:"adding-repositories-in-the-correct-order",level:4},{value:"Re-checking the currently known eopkg repositories",id:"re-checking-the-currently-known-eopkg-repositories",level:4},{value:"Disabling the local solbuild repository in eopkg",id:"disabling-the-local-solbuild-repository-in-eopkg",level:4},{value:"Closing thoughts",id:"closing-thoughts",level:2}];function c(e){const o={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.h1,{id:"packaging-using-a-local-repository",children:"Packaging Using a Local Repository"}),"\n",(0,l.jsxs)(o.p,{children:["This guide walks you through the steps necessary to tell solbuild how to utilise locally built ",(0,l.jsx)(o.code,{children:".eopkg's"})," that are not yet in the Solus repository."]}),"\n",(0,l.jsx)(o.admonition,{type:"note",children:(0,l.jsx)(o.p,{children:"It is not necessary to use a local repository to test most package submissions. The easier and recommended way is to install the eopkg files provided when a package is built. This is intended for use with stack upgrades, rebuilds, or new packages that need new dependencies that are not yet in the repo."})}),"\n",(0,l.jsxs)(o.p,{children:["We assume you have worked through the ",(0,l.jsx)(o.a,{href:"/docs/packaging",children:"packaging"})," material for creating a package with solbuild."]}),"\n",(0,l.jsx)(o.h2,{id:"install-the-local-profile",children:"Install the local profile"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-bash",children:"sudo eopkg install solbuild-config-local-unstable\n"})}),"\n",(0,l.jsxs)(o.p,{children:["You will also need to ensure that your repository is fully up to date. See ",(0,l.jsx)(o.a,{href:"/docs/packaging/update-dev-environment",children:"Update Your Development Environment"})]}),"\n",(0,l.jsx)(o.h2,{id:"utilising-the-local-repository",children:"Utilising the local repository"}),"\n",(0,l.jsx)(o.p,{children:"Solbuild has had support for local repos since its creation."}),"\n",(0,l.jsxs)(o.p,{children:["Improvements have been made to make it simple for contributors to test fixes out of the repo without having to wait for each patch to be merged. To include ",(0,l.jsx)(o.code,{children:".eopkg"})," files within a build, they need to be copied to the local repo directory ",(0,l.jsx)(o.code,{children:"/var/lib/solbuild/local"}),"."]}),"\n",(0,l.jsxs)(o.p,{children:["Note that you will need both the regular package and the ",(0,l.jsx)(o.code,{children:"-devel"})," package if you want to build another package against them using ",(0,l.jsx)(o.code,{children:"pkgconfig()"})," in the ",(0,l.jsx)(o.code,{children:"package.yml file"}),"."]}),"\n",(0,l.jsxs)(o.p,{children:["With the ",(0,l.jsx)(o.code,{children:".eopkg"})," files now present in the local repo, we can make use of them in solbuild by running ",(0,l.jsx)(o.code,{children:"go-task build-local"})," rather than just ",(0,l.jsx)(o.code,{children:"go-task"}),". This will index the local repository and prioritise their use over what is available in the Solus unstable repository."]}),"\n",(0,l.jsx)(o.h2,{id:"best-practices-when-working-with-a-solbuild-local-repository",children:"Best practices when working with a solbuild local repository"}),"\n",(0,l.jsx)(o.p,{children:"There are some important things to know when working with local repositories, as they may lead to issues later on."}),"\n",(0,l.jsxs)(o.ul,{children:["\n",(0,l.jsxs)(o.li,{children:["Solbuild will use your version of a package from the local repo regardless of whether there's a higher release in the Solus repository. Therefore you should only use ",(0,l.jsx)(o.code,{children:"go-task build-local"})," when required and also remove old packages from the local repo when no longer needed."]}),"\n",(0,l.jsx)(o.li,{children:"If the package is already installed in the solbuild image, the release must be higher for it to be installed."}),"\n"]}),"\n",(0,l.jsx)(o.h2,{id:"eopkg-and-local-repositories",children:"Eopkg and local repositories"}),"\n",(0,l.jsx)(o.p,{children:"As alluded to above, eopkg supports resolving packages from more than one repository."}),"\n",(0,l.jsx)(o.p,{children:"In practice, this can be leveraged to make the developer workflow more convenient by ensuring that eopkg pulls from the local solbuild repository."}),"\n",(0,l.jsx)(o.h3,{id:"generating-an-eopkg-index-for-the-local-solbuild-repository",children:"Generating an eopkg index for the local solbuild repository"}),"\n",(0,l.jsx)(o.p,{children:"Before packages from the local solbuild repository can be resolved, an eopkg index file needs to be created."}),"\n",(0,l.jsxs)(o.p,{children:["As mentioned earlier, the local solbuild repo installed by the ",(0,l.jsx)(o.code,{children:"solbuild-config-local-unstable"})," package lives in ",(0,l.jsx)(o.code,{children:"/var/lib/solbuild/local"}),"."]}),"\n",(0,l.jsxs)(o.p,{children:["To generate or refresh the eopkg index in ",(0,l.jsx)(o.code,{children:"/var/lib/solbuild/local"}),", simply run:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-bash",children:"sudo eopkg index --skip-signing /var/lib/solbuild/local/ --output /var/lib/solbuild/local/eopkg-index.xml\n"})}),"\n",(0,l.jsx)(o.h3,{id:"a-note-on-package-resolution-priority",children:"A note on package resolution priority"}),"\n",(0,l.jsxs)(o.p,{children:["It bears repeating that in its current incarnation, eopkg will always prefer packages from the topmost repository listed with ",(0,l.jsx)(o.code,{children:"eopkg lr"}),"."]}),"\n",(0,l.jsxs)(o.p,{children:["In other words, if a package exists both in the local solbuild repository and the official upstream Solus repository, eopkg will only consider the package from the first repository listed with ",(0,l.jsx)(o.code,{children:"eopkg lr"})," ",(0,l.jsx)(o.em,{children:"regardless of its release number"}),"."]}),"\n",(0,l.jsx)(o.h3,{id:"adding-the-local-solbuild-repo-to-the-eopkg-repository-database",children:"Adding the local solbuild repo to the eopkg repository database"}),"\n",(0,l.jsxs)(o.p,{children:["The easiest way to add the local solbuild repo to the list of repositories known to eopkg is to add the local solbuild repo and then ",(0,l.jsx)(o.em,{children:"re-add"})," the official Solus repo."]}),"\n",(0,l.jsx)(o.h4,{id:"checking-the-currently-known-eopkg-repositories",children:"Checking the currently known eopkg repositories"}),"\n",(0,l.jsxs)(o.p,{children:["But first, let's list the repositories currently known to eopkg with ",(0,l.jsx)(o.code,{children:"eopkg lr"})," -- this should produce output similar to:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:"Solus [active]\n   https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\n"})}),"\n",(0,l.jsx)(o.h4,{id:"adding-repositories-in-the-correct-order",children:"Adding repositories in the correct order"}),"\n",(0,l.jsx)(o.p,{children:"Now the repositories need to be added to account for the desired dependency resolution order:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{className:"language-bash",children:"sudo eopkg ar Local /var/lib/solbuild/local/eopkg-index.xml.xz\nsudo eopkg ar Solus https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\n"})}),"\n",(0,l.jsx)(o.p,{children:"This should yield output similar to:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:"$ sudo eopkg ar Local /var/lib/solbuild/local/eopkg-index.xml.xz\nRepo Local added to system.\nUpdating repository: Local\nPackage database updated.\n$ sudo eopkg ar Solus https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\nRepo already present with name Solus and same URL. Removing first.\nRepo Solus added to system.\nUpdating repository: Solus\neopkg-index.xml.xz.sha1sum     (40.0  B)100%    765.61 KB/s [00:00:00] [complete]\neopkg-index.xml.xz             (2.1 MB)100%    914.38 KB/s [00:00:01] [complete]\nPackage database updated.\n"})}),"\n",(0,l.jsx)(o.h4,{id:"re-checking-the-currently-known-eopkg-repositories",children:"Re-checking the currently known eopkg repositories"}),"\n",(0,l.jsx)(o.p,{children:"All that is left now is to check that the dependency resolution order is correct so that packages from the local solbuild repository are preferred over the upstream Solus repository."}),"\n",(0,l.jsxs)(o.p,{children:["Thus, ",(0,l.jsx)(o.code,{children:"eopkg lr"})," should yield output similar to:"]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:"$ eopkg lr\nLocal [active]\n   /var/lib/solbuild/local/eopkg-index.xml.xz\nSolus [active]\n   https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\n"})}),"\n",(0,l.jsx)(o.h4,{id:"disabling-the-local-solbuild-repository-in-eopkg",children:"Disabling the local solbuild repository in eopkg"}),"\n",(0,l.jsxs)(o.p,{children:["To reset the system to use packages from the official Solus repository exclusively, the ",(0,l.jsx)(o.code,{children:"Local"})," eopkg repository can be disabled with the command ",(0,l.jsx)(o.code,{children:"sudo eopkg disable-repo Local"}),"."]}),"\n",(0,l.jsx)(o.p,{children:"The output should look similar to:"}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:"$ sudo eopkg disable-repo Local\n$ sudo eopkg lr\nLocal [inactive]\n   /var/lib/solbuild/local/eopkg-index.xml.xz\nSolus [active]\n   https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\n"})}),"\n",(0,l.jsxs)(o.p,{children:["The ",(0,l.jsx)(o.code,{children:"Local"})," eopkg repository can be re-enabled with ",(0,l.jsx)(o.code,{children:"sudo eopkg enable-repo Local"}),"."]}),"\n",(0,l.jsx)(o.pre,{children:(0,l.jsx)(o.code,{children:"$ sudo eopkg enable-repo Local\n$ sudo eopkg lr\nLocal [active]\n   /var/lib/solbuild/local/eopkg-index.xml.xz\nSolus [active]\n   https://cdn.getsol.us/repo/unstable/eopkg-index.xml.xz\n"})}),"\n",(0,l.jsx)(o.h2,{id:"closing-thoughts",children:"Closing thoughts"}),"\n",(0,l.jsx)(o.p,{children:"Congratulations on making it this far! Your system should now be ready for convenient deployment and testing of locally built packages."}),"\n",(0,l.jsx)(o.p,{children:"Note that packages not present in the local solbuild repository will be fetched from the upstream official Solus (unstable) repository."}),"\n",(0,l.jsx)(o.p,{children:"Finally, keep in mind that the eopkg index needs to be refreshed whenever you add or remove locally built packages to your local solbuild repository -- otherwise eopkg won't know that new packages are available / have been removed from the repository."})]})}function p(e={}){const{wrapper:o}={...(0,s.a)(),...e.components};return o?(0,l.jsx)(o,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},11151:(e,o,i)=>{i.d(o,{Z:()=>r,a:()=>n});var l=i(67294);const s={},t=l.createContext(s);function n(e){const o=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),l.createElement(t.Provider,{value:o},e.children)}}}]);